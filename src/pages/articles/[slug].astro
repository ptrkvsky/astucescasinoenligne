---
import { getAllPostsWithSlugs, getPostBySlug } from '../../lib/api';
import Header from '../../components/Header.astro';
import '../../assets/css/bootstrap.min.css';
import '../../assets/css/style.css';
import '../../assets/css/responsive.css';
import '../../assets/css/article.css';
import { seoConfig } from '../../utils/seoConfig';
import LayoutPrimary from '../../components/LayoutPrimary.astro';

export async function getStaticPaths() {
  const postsWithSlugs = await getAllPostsWithSlugs();
  return postsWithSlugs.edges.map(({ node }) => {
    return {
      params: { slug: node.slug },
    };
  });
}

const { slug } = Astro.params;
const post = await getPostBySlug(slug);
const content = post.content || '';
const schema = JSON.stringify(post?.seo?.schema?.raw);
---

<LayoutPrimary
  title={post.seo.title}
  description={post.seo.metaDesc}
  canonical={`${seoConfig.baseURL}/articles/${post.slug}`}
  schema={post?.seo?.schema?.raw}
>
  <div slot="main">
    <div class="flex flex-col p-10">
      <div id="single-post-page" class="single-post-section division">
        <div class="container">
          <div class="row">
            <!-- SINGLE POST -->
            <div class="col-md-12">
              <h1>{post.title}</h1>
              <article class="prose lg:prose-xl" set:html={content}></article>
            </div>
          </div>
        </div>
      </div>
    </div>

    <style is:global>
      .toc_list {
        font-size: 16px;
        color: #0002eb;
      }

      .toc_list li {
        margin-bottom: 0;
      }
      figure,
      iframe {
        max-width: 100% !important;
      }
    </style>
  </div>
</LayoutPrimary>
